{% extends "admin/base.html" %}

{% block title %} 
        Patients Lists
{% endblock %}

{% block content %}

<h3 class="mt-4">Patient List</h3>
<br>
<table class="table table-bordered table-striped">
    <thead class="table-dark">
        <tr>
            <th>Patient ID</th>
            <th>Patient Name</th>
            <th>Age</th>
            <th>Phone Number</th>
            <th>Latest Appointment</th>
            <th>Total Appointments</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {%for patient in patients %}
        <tr>
            <td>{{ patient.id }}</td>
            <td>{{ patient.name }}</td>
            <td>{{ patient.age }}</td>
            <td>{{ patient.phone_number }}</td>
            <td>
                {% if patient.latest_appointment %}
                    {{ patient.latest_appointment.date }} at {{ patient.latest_appointment.time.strftime('%H:%M') }}
                {% else %}
                    N/A
                {% endif %}
            </td>
            <td>{{ patient.total_appointments }}</td>
            <td>
                <a href="{{ url_for('admin.view_patient_detail', patient_id=patient.id) }}" class="btn btn-info btn-sm">View</a>
                <a href="{{ url_for('admin.edit_patient', patient_id=patient.id) }}" class="btn btn-warning btn-sm">Edit</a>
                <form method="POST" 
                    action="{{ url_for('admin.delete_patient', patient_id=patient.id) }}" style="display:inline;" 
                    onsubmit="return confirm('Are you sure you want to delete {{ patient.name }}?');">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" class="text-center">No patients found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<div class="text-center mt-4">
    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
</div>
{% endblock %}
