{% extends "admin_base.html" %}

{% block title %}
    Doctor Details
{% endblock %}

{% block content %}

<div class="container mt-4">
    <h2 class="mb-4">
        {% if doctor.user.name.startswith("Dr.") %}
            {{ doctor.user.name }}
        {% else %}
            Dr. {{ doctor.user.name }}
        {% endif %}
    </h2>

    <p><strong>Specialization:</strong> {{ doctor.specialization }}</p>
    {% if availability_schedule %}
+       <p><strong>Weekly Availability:</strong></p>
+       <ul class="list-group">
+           {% for day, slots in availability_schedule.items()|sort %}
+               <li class="list-group-item">
+                   <strong>{{ day }}:</strong> {{ ", ".join(slots) }}
+               </li>
+           {% endfor %}
+       </ul>
+   {% else %}
+       <p class="text-muted">No availability has been set for this doctor.</p>
+   {% endif %}
</div>

<h3 class="mt-4">
    Appointments Summary
    <span class="badge bg-primary">Today: {{ today_count }}</span>
    <span class="badge bg-success">Completed: {{ completed_count }}</span>
    <span class="badge bg-warning text-dark">Pending: {{ pending_count }}</span>
</h3>

<h3 class="mt-4">Appointments</h3>

<table class="table table-bordered table-striped">
    <thead class="table-dark">
        <tr>
            <th>Appointment ID</th>
            <th>Patient Name</th>
            <th>Date</th>
            <th>Time</th>
            <th>Problem</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% if appointments %}
        {% for appt in appointments|sort(attribute='date')|sort(attribute='time') %}
        <tr class="{% if appt.date == date.today() %}table-info{% endif %}">
            <td>{{ appt.id }}</td>
            <td>{{ appt.patient.user.name }}</td>
            <td>{{ appt.date }}</td>
            <td>{{ appt.time.strftime('%H:%M') }}</td>
            <td>{{ appt.problem }}</td>
            <td>{{ appt.status.value }}</td>
            <td>
                <form method="POST" action="{{ url_for('admin.delete_appointment', appointment_id=appt.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this appointment?');">Delete</button>
                </form>
                <a href="#" class="btn btn-warning btn-sm">Edit</a>
            </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
            <td colspan="7" class="text-center">No appointments found </td>
        </tr>
        {% endif %}
    </tbody>
</table>

<div class="text-center mt-4">
    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
</div>
<div class="text-center mt-4">
<a href="{{ url_for('admin.view_doctors') }}" class="btn btn-secondary mt-3">Back to Doctors List</a>
</div>
{% endblock %}
